# –°—Ç–∞–Ω–¥–∞—Ä—Ç—ã –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è

–î–ª—è –æ–±–µ—Å–ø–µ—á–µ–Ω–∏—è –∫–∞—á–µ—Å—Ç–≤–∞, –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç–∏ –∏ –∫–æ–Ω—Å–∏—Å—Ç–µ–Ω—Ç–Ω–æ—Å—Ç–∏ –∫–æ–¥–∞ –≤—Å–µ –∫–æ–Ω—Ç—Ä–∏–±—å—é—Ç–æ—Ä—ã –¥–æ–ª–∂–Ω—ã —Å–ª–µ–¥–æ–≤–∞—Ç—å —ç—Ç–∏–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–∞–º.

---

## –°–æ–¥–µ—Ä–∂–∞–Ω–∏–µ

- [–û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ C#](#-–æ–±—â–∏–µ-—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏-c)
- [–ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –¥–∏–∑–∞–π–Ω](#-–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞-–∏-–¥–∏–∑–∞–π–Ω)
- [–ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ –ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ](#-–∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ–µ-–ø—Ä–æ–≥—Ä–∞–º–º–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [–û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫](#-–æ–±—Ä–∞–±–æ—Ç–∫–∞-–æ—à–∏–±–æ–∫)
- [–†–∞–±–æ—Ç–∞ —Å —Ñ–∞–π–ª–∞–º–∏](#-—Ä–∞–±–æ—Ç–∞-—Å-—Ñ–∞–π–ª–∞–º–∏)
- [XAML –∏ UI](#-xaml-–∏-ui)
- [–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ](#-—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ)
- [–î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è](#-–¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è)
- [Git –∏ –∫–æ–Ω—Ç—Ä–æ–ª—å –≤–µ—Ä—Å–∏–π](#-git-–∏-–∫–æ–Ω—Ç—Ä–æ–ª—å-–≤–µ—Ä—Å–∏–π)

---

## üíª –û–±—â–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏ C#

### –í–µ—Ä—Å–∏—è —è–∑—ã–∫–∞

- **Target Framework:** .NET 10
- **C# Version:** 13 (latest)
- –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –Ω–æ–≤–µ–π—à–∏–µ –≤–æ–∑–º–æ–∂–Ω–æ—Å—Ç–∏ —è–∑—ã–∫–∞

### –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

- **–û—Ç—Å—Ç—É–ø—ã:** 4 –ø—Ä–æ–±–µ–ª–∞ (–Ω–µ —Ç–∞–±—ã)
- **–°–∫–æ–±–∫–∏:** Allman style (—Å–∫–æ–±–∫–∏ –Ω–∞ –Ω–æ–≤–æ–π —Å—Ç—Ä–æ–∫–µ)
- **–†–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è:** –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `.editorconfig`

```csharp
// ‚úÖ –ü—Ä–∞–≤–∏–ª—å–Ω–æ (Allman style)
public void DoSomething()
{
    if (condition)
    {
        // ...
    }
}
```

### –ö–æ–Ω–≤–µ–Ω—Ü–∏–∏ –∏–º–µ–Ω–æ–≤–∞–Ω–∏—è

| –¢–∏–ø | –°—Ç–∏–ª—å | –ü—Ä–∏–º–µ—Ä |
|-----|-------|--------|
| –ö–ª–∞—Å—Å—ã, –º–µ—Ç–æ–¥—ã, —Å–≤–æ–π—Å—Ç–≤–∞ | PascalCase | `GameSessionService`, `LoadAsync()` |
| –õ–æ–∫–∞–ª—å–Ω—ã–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ | camelCase | `userName`, `isValid` |
| –ü—Ä–∏–≤–∞—Ç–Ω—ã–µ –ø–æ–ª—è | _camelCase | `_configService`, `_isLoading` |
| –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã | IPrefix | `IService`, `IDisposable` |
| –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã | PascalCase | `MaxRetryCount` |
| Enum –∑–Ω–∞—á–µ–Ω–∏—è | PascalCase | `ConnectionState.Connected` |

---

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –∏ –¥–∏–∑–∞–π–Ω

### MVVM (Model-View-ViewModel)

#### –°—Ç—Ä–æ–≥–æ–µ —Ä–∞–∑–¥–µ–ª–µ–Ω–∏–µ

ViewModels **–Ω–µ –¥–æ–ª–∂–Ω—ã** —Å—Å—ã–ª–∞—Ç—å—Å—è –Ω–∞ Avalonia Controls:

```csharp
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û!
public class MyViewModel
{
    public Button PlayButton { get; set; }
    public Window MainWindow { get; set; }
}

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
public class MyViewModel : ReactiveObject
{
    private string _buttonText;
    public string ButtonText
    {
        get => _buttonText;
        set => this.RaiseAndSetIfChanged(ref _buttonText, value);
    }
    
    public ReactiveCommand<Unit, Unit> PlayCommand { get; }
    
    public MyViewModel()
    {
        PlayCommand = ReactiveCommand.Create(() => { });
    }
}
```

#### –°–≤–æ–π—Å—Ç–≤–∞

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `RaiseAndSetIfChanged` –∏–∑ ReactiveUI:

```csharp
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (—Ä—É—á–Ω–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è INotifyPropertyChanged)
private string _name;
public string Name
{
    get => _name;
    set
    {
        if (_name != value)
        {
            _name = value;
            OnPropertyChanged();
        }
    }
}

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (ReactiveUI)
private string _name;
public string Name
{
    get => _name;
    set => this.RaiseAndSetIfChanged(ref _name, value);
}
```

#### –ö–æ–º–∞–Ω–¥—ã

–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `ReactiveCommand` –∏–∑ ReactiveUI:

```csharp
// ‚úÖ –°–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞
public ReactiveCommand<Unit, Unit> SaveCommand { get; }

public MyViewModel(IConfigService configService)
{
    SaveCommand = ReactiveCommand.Create(() => configService.Save());
}

// ‚úÖ –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–∞—è –∫–æ–º–∞–Ω–¥–∞
public ReactiveCommand<Unit, Unit> LoadCommand { get; }

public MyViewModel(IService service)
{
    LoadCommand = ReactiveCommand.CreateFromTask(async () =>
    {
        Data = await service.LoadAsync();
    });
}

// ‚úÖ –° —É—Å–ª–æ–≤–∏–µ–º CanExecute
private string _name;
public string Name
{
    get => _name;
    set => this.RaiseAndSetIfChanged(ref _name, value);
}

public ReactiveCommand<Unit, Unit> SaveCommand { get; }

public MyViewModel()
{
    var canSave = this.WhenAnyValue(x => x.Name)
        .Select(name => !string.IsNullOrEmpty(name));
    
    SaveCommand = ReactiveCommand.Create(() => { }, canSave);
}
```

---

### –ê—Å–∏–Ω—Ö—Ä–æ–Ω–Ω–æ—Å—Ç—å

#### –ü—Ä–∞–≤–∏–ª–∞

1. **–°—É—Ñ—Ñ–∏–∫—Å `Async`** –¥–ª—è –≤—Å–µ—Ö –∞—Å–∏–Ω—Ö—Ä–æ–Ω–Ω—ã—Ö –º–µ—Ç–æ–¥–æ–≤
2. **`async`/`await`** –¥–ª—è I/O –æ–ø–µ—Ä–∞—Ü–∏–π
3. **–ò–∑–±–µ–≥–∞–π—Ç–µ `Task.Run`** –¥–ª—è I/O (—Ç–æ–ª—å–∫–æ –¥–ª—è CPU-intensive)
4. **–û–±—Ä–∞–±–∞—Ç—ã–≤–∞–π—Ç–µ –∏—Å–∫–ª—é—á–µ–Ω–∏—è** –≤ `async void` –º–µ—Ç–æ–¥–∞—Ö

```csharp
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
public async Task<Config> LoadConfigAsync()
{
    var json = await File.ReadAllTextAsync(path);
    return JsonConvert.DeserializeObject<Config>(json);
}

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (–Ω–µ—Ç —Å—É—Ñ—Ñ–∏–∫—Å–∞)
public async Task<Config> LoadConfig() { }

// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (Task.Run –¥–ª—è I/O)
public async Task<Config> LoadConfigAsync()
{
    return await Task.Run(() => File.ReadAllText(path));
}
```

#### –û–±—Ä–∞–±–æ—Ç–∫–∞ –∏—Å–∫–ª—é—á–µ–Ω–∏–π –≤ async void

```csharp
// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
private async void OnButtonClick()
{
    try
    {
        await LoadDataAsync();
    }
    catch (Exception ex)
    {
        Logger.Error("Load", ex.Message);
    }
}
```

---

### Null Safety

**Nullable Reference Types** –≤–∫–ª—é—á–µ–Ω—ã (`<Nullable>enable</Nullable>`).

#### –ü—Ä–∞–≤–∏–ª–∞

1. **–ò–∑–±–µ–≥–∞–π—Ç–µ `!`** (null-forgiving operator) ‚Äî –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —Ç–æ–ª—å–∫–æ –∫–æ–≥–¥–∞ –∞–±—Å–æ–ª—é—Ç–Ω–æ —É–≤–µ—Ä–µ–Ω—ã
2. **–ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ null** —á–µ—Ä–µ–∑ pattern matching
3. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ `?`** –¥–ª—è nullable —Ç–∏–ø–æ–≤

```csharp
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
var name = user!.Name; // –û–ø–∞—Å–Ω–æ!

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
if (user is not null)
{
    var name = user.Name;
}

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (null-–∫–æ–∞–ª–µ—Å—Ü–µ–Ω—Ü–∏—è)
var name = user?.Name ?? "Unknown";
```

---

## üìê –°–ª–æ–∏ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è

### UI Layer

- **–¢–æ–ª—å–∫–æ** –ª–æ–≥–∏–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è
- **–ú–∏–Ω–∏–º–∞–ª—å–Ω—ã–π** code-behind
- –°–ª–æ–∂–Ω—ã–µ –≤—ã—á–∏—Å–ª–µ–Ω–∏—è ‚Üí —Å–µ—Ä–≤–∏—Å—ã

```csharp
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (–ª–æ–≥–∏–∫–∞ –≤ code-behind)
private async void Button_Click(object sender, RoutedEventArgs e)
{
    var data = await FetchFromApi();
    ProcessData(data);
    UpdateUI(data);
}

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (–ª–æ–≥–∏–∫–∞ –≤ ViewModel)
public ReactiveCommand<Unit, Unit> LoadDataCommand { get; }

public MyViewModel(IService service)
{
    LoadDataCommand = ReactiveCommand.CreateFromTask(async () =>
    {
        Data = await service.LoadAsync();
    });
}
```

### Service Layer

- **Stateless** singleton —Å–µ—Ä–≤–∏—Å—ã
- **Single Responsibility** ‚Äî –æ–¥–∏–Ω —Å–µ—Ä–≤–∏—Å = –æ–¥–Ω–∞ –∑–∞–¥–∞—á–∞
- State ‚Üí –º–æ–¥–µ–ª–∏ –∏–ª–∏ session managers

```csharp
// ‚úÖ –ü—Ä–∏–º–µ—Ä —Ö–æ—Ä–æ—à–µ–≥–æ —Å–µ—Ä–≤–∏—Å–∞
public class ConfigService
{
    private readonly string _configPath;
    
    public Config Load() => JsonConvert.DeserializeObject<Config>(
        File.ReadAllText(_configPath));
    
    public void Save(Config config) => 
        File.WriteAllText(_configPath, JsonConvert.SerializeObject(config));
}
```

---

## üíâ Dependency Injection

### –ü—Ä–∞–≤–∏–ª–∞

1. **–ù–µ —Å–æ–∑–¥–∞–≤–∞–π—Ç–µ —Å–µ—Ä–≤–∏—Å—ã –≤—Ä—É—á–Ω—É—é** ‚Äî –ø–æ–ª—É—á–∞–π—Ç–µ —á–µ—Ä–µ–∑ DI
2. **–ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –∫–æ–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä–Ω—É—é –∏–Ω—ä–µ–∫—Ü–∏—é**
3. **–†–µ–≥–∏—Å—Ç—Ä–∏—Ä—É–π—Ç–µ –≤ `Bootstrapper.cs`**

```csharp
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û
public MyViewModel()
{
    _service = new MyService();
}

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û
public MyViewModel(MyService service)
{
    _service = service;
}
```

### –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è

```csharp
// Bootstrapper.cs
services.AddSingleton<ConfigService>();
services.AddSingleton<GameSessionService>();
services.AddTransient<SettingsViewModel>();
```

---

## üìù –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –∏ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

### XML –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

–ü—É–±–ª–∏—á–Ω—ã–µ API –¥–æ–ª–∂–Ω—ã –∏–º–µ—Ç—å XML –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—é:

```csharp
/// <summary>
/// –ó–∞–≥—Ä—É–∂–∞–µ—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é –∏–∑ —Ñ–∞–π–ª–∞.
/// </summary>
/// <param name="path">–ü—É—Ç—å –∫ —Ñ–∞–π–ª—É –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏.</param>
/// <returns>–ó–∞–≥—Ä—É–∂–µ–Ω–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–ª–∏ null.</returns>
/// <exception cref="FileNotFoundException">–§–∞–π–ª –Ω–µ –Ω–∞–π–¥–µ–Ω.</exception>
public Config? LoadConfig(string path)
```

### –ö–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –≤ –∫–æ–¥–µ

–û–±—ä—è—Å–Ω—è–π—Ç–µ **–ø–æ—á–µ–º—É**, –∞ –Ω–µ **—á—Ç–æ**:

```csharp
// ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (–æ–ø–∏—Å—ã–≤–∞–µ—Ç —á—Ç–æ)
// –£–≤–µ–ª–∏—á–∏–≤–∞–µ–º —Å—á—ë—Ç—á–∏–∫ –Ω–∞ 1
counter++;

// ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (–æ–±—ä—è—Å–Ω—è–µ—Ç –ø–æ—á–µ–º—É)
// –ö–æ–º–ø–µ–Ω—Å–∏—Ä—É–µ–º off-by-one –≤ API –æ—Ç–≤–µ—Ç–µ
counter++;
```

---

## üé® UI —Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞

### –°—Ç–∏–ª–∏

```xml
<!-- ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (hardcoded —Ü–≤–µ—Ç–∞) -->
<Button Background="#FFA845"/>

<!-- ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (—á–µ—Ä–µ–∑ —Ä–µ—Å—É—Ä—Å—ã) -->
<Button Background="{DynamicResource SystemAccentBrush}"/>
```

### –ò–∫–æ–Ω–∫–∏

```xml
<!-- ‚ùå –ù–ï–ü–†–ê–í–ò–õ–¨–ù–û (Bitmap) -->
<Image Source="/Assets/Icons/play.png"/>

<!-- ‚úÖ –ü–†–ê–í–ò–õ–¨–ù–û (SVG) -->
<svg:Svg Path="/Assets/Icons/play.svg"/>
```

### Data Binding

```xml
<!-- ‚úÖ –° compile-time –ø—Ä–æ–≤–µ—Ä–∫–æ–π -->
<UserControl x:DataType="vm:MyViewModel">
    <TextBlock Text="{Binding Name}"/>
</UserControl>
```

---

## ‚ö†Ô∏è –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã

### ClientPatcher

**–§–∞–π–ª:** `Services/Game/ClientPatcher.cs`

> ‚ö†Ô∏è **–í–ù–ò–ú–ê–ù–ò–ï:** –ò–∑–º–µ–Ω—è–π—Ç–µ —Ç–æ–ª—å–∫–æ —Å –ø–æ–ª–Ω—ã–º –ø–æ–Ω–∏–º–∞–Ω–∏–µ–º –ø–æ—Å–ª–µ–¥—Å—Ç–≤–∏–π!
> –≠—Ç–æ—Ç –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –≤–ª–∏—è–µ—Ç –Ω–∞ —Ü–µ–ª–æ—Å—Ç–Ω–æ—Å—Ç—å –∏–≥—Ä—ã.

---

## ‚úÖ –ß–µ–∫–ª–∏—Å—Ç –ø–µ—Ä–µ–¥ –∫–æ–º–º–∏—Ç–æ–º

- [ ] –ö–æ–¥ –∫–æ–º–ø–∏–ª–∏—Ä—É–µ—Ç—Å—è –±–µ–∑ warnings
- [ ] `<Nullable>enable</Nullable>` ‚Äî –Ω–µ—Ç `!` –±–µ–∑ –ø—Ä–∏—á–∏–Ω—ã
- [ ] Async –º–µ—Ç–æ–¥—ã –∏–º–µ—é—Ç —Å—É—Ñ—Ñ–∏–∫—Å `Async`
- [ ] ViewModels –Ω–µ —Å—Å—ã–ª–∞—é—Ç—Å—è –Ω–∞ UI Controls
- [ ] –°–µ—Ä–≤–∏—Å—ã –ø–æ–ª—É—á–∞—é—Ç—Å—è —á–µ—Ä–µ–∑ DI
- [ ] –ü—É–±–ª–∏—á–Ω—ã–µ –º–µ—Ç–æ–¥—ã –∑–∞–¥–æ–∫—É–º–µ–Ω—Ç–∏—Ä–æ–≤–∞–Ω—ã
- [ ] –ù–µ—Ç hardcoded —Ü–≤–µ—Ç–æ–≤ –≤ XAML
- [ ] SVG –¥–ª—è –∏–∫–æ–Ω–æ–∫ (–Ω–µ Bitmap)

---

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- [MVVMPatterns.md](MVVMPatterns.md) ‚Äî –ü–∞—Ç—Ç–µ—Ä–Ω—ã MVVM
- [UIComponentGuide.md](UIComponentGuide.md) ‚Äî –°–æ–∑–¥–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
- [StylingGuide.md](StylingGuide.md) ‚Äî –°—Ç–∏–ª–∏–∑–∞—Ü–∏—è
