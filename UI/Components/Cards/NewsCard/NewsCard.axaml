<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:asyncImageLoader="clr-namespace:AsyncImageLoader;assembly=AsyncImageLoader.Avalonia"
             xmlns:models="using:HyPrism.Models"
             mc:Ignorable="d" d:DesignWidth="400" d:DesignHeight="100"
             x:Class="HyPrism.UI.Components.Cards.NewsCard"
             x:DataType="models:NewsItemResponse"
             x:Name="Root">

    <UserControl.Styles>
        <!-- Define styles specifically for this internal button class -->
        <Style Selector="Button.news-card-btn">
            <Setter Property="Background" Value="#1A1A1A"/>
            <Setter Property="BorderBrush" Value="#2A2A2A"/>
            <Setter Property="BorderThickness" Value="1"/>
            <Setter Property="CornerRadius" Value="10"/>
            <Setter Property="Padding" Value="10"/>
        </Style>
        
        <Style Selector="Button.news-card-btn:pointerover">
             <Setter Property="Background" Value="#252525"/>
             <Setter Property="BorderBrush" Value="#3A3A3A"/>
        </Style>
        
        <Style Selector="Button.news-card-btn:pressed">
             <Setter Property="Background" Value="#151515"/>
        </Style>
    </UserControl.Styles>

    <!-- Use fallback null for command to prevent binding errors at design time -->
    <Button Command="{Binding $parent[ItemsControl].DataContext.OpenLinkCommand, FallbackValue={x:Null}}"
            CommandParameter="{Binding Url}"
            Classes="news-card-btn"
            HorizontalAlignment="Stretch"
            HorizontalContentAlignment="Stretch"
            FocusAdorner="{x:Null}">
        
        <!-- COMPLETE TEMPLATE REPLACEMENT: Disables default Fluent visuals -->
        <Button.Template>
            <ControlTemplate TargetType="Button">
                <Border Name="CardBorder"
                        Background="{TemplateBinding Background}"
                        BorderBrush="{TemplateBinding BorderBrush}"
                        BorderThickness="{TemplateBinding BorderThickness}"
                        CornerRadius="{TemplateBinding CornerRadius}"
                        Padding="{TemplateBinding Padding}">
                    <Border.Transitions>
                        <Transitions>
                            <BrushTransition Property="Background" Duration="0:0:0.2"/>
                            <BrushTransition Property="BorderBrush" Duration="0:0:0.2"/>
                        </Transitions>
                    </Border.Transitions>
                    
                    <ContentPresenter Content="{TemplateBinding Content}"
                                      ContentTemplate="{TemplateBinding ContentTemplate}"/>
                </Border>
            </ControlTemplate>
        </Button.Template>

        <Grid ColumnDefinitions="Auto, *">
            <!-- News Image (Thumbnail) -->
            <Border Grid.Column="0"
                    Width="80"
                    Height="80"
                    CornerRadius="8"
                    ClipToBounds="True"
                    Margin="0,0,12,0"
                    Background="#0F0F0F">
                <Image asyncImageLoader:ImageLoader.Source="{Binding ImageUrl}"
                       Stretch="UniformToFill"
                       RenderOptions.BitmapInterpolationMode="HighQuality"/>
            </Border>
            
            <!-- Content -->
            <StackPanel Grid.Column="1" Spacing="6" VerticalAlignment="Center">
                <!-- Title -->
                <TextBlock Text="{Binding Title}" 
                           FontWeight="Bold" 
                           Foreground="White" 
                           FontSize="13"
                           TextWrapping="Wrap"
                           MaxLines="2"
                           LineHeight="18"/>
                
                <!-- Excerpt -->
                <TextBlock Text="{Binding Excerpt}" 
                           FontSize="11" 
                           Foreground="#AAAAAA"
                           TextWrapping="Wrap"
                           MaxLines="2"
                           LineHeight="15"
                           TextTrimming="CharacterEllipsis"/>
                
                <!-- Meta Info -->
                <Grid ColumnDefinitions="Auto, *" Margin="0,2,0,0">
                    <StackPanel Grid.Column="0" 
                                Orientation="Horizontal" 
                                Spacing="6">
                        <TextBlock Text="{Binding Author}" 
                                   FontSize="10" 
                                   Foreground="#999"
                                   FontWeight="Medium"/>
                    </StackPanel>
                    <TextBlock Grid.Column="1" 
                               Text="{Binding Date}" 
                               FontSize="10" 
                               Foreground="#777"
                               HorizontalAlignment="Right"
                               VerticalAlignment="Center"/>
                </Grid>
            </StackPanel>
        </Grid>
    </Button>
</UserControl>