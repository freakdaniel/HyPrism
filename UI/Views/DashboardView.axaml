<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:HyPrism.UI.ViewModels"
             xmlns:views="using:HyPrism.UI.Views"
             xmlns:layouts="using:HyPrism.UI.Components.Layouts"
             xmlns:dashboard="using:HyPrism.UI.Components.Dashboard"
             xmlns:btn="using:HyPrism.UI.Components.Buttons"
             xmlns:conv="using:HyPrism.UI.Converters"
             xmlns:trans="using:HyPrism.UI.Views.Transitions"
             mc:Ignorable="d" d:DesignWidth="1280" d:DesignHeight="800"
             x:Class="HyPrism.UI.Views.DashboardView"
             x:DataType="vm:DashboardViewModel">

    <Grid>
        <!-- Background Layer (Global) -->
        <Grid>
            <!-- Background Image with Transitions -->
            <Image Source="{Binding BackgroundImage}" 
                   Stretch="UniformToFill" 
                   Opacity="{Binding BackgroundOpacity}">
                <Image.Transitions>
                    <Transitions>
                        <DoubleTransition Property="Opacity" Duration="0:0:0.4" Easing="CubicEaseInOut"/>
                    </Transitions>
                </Image.Transitions>
            </Image>
            <Rectangle Fill="#CC090909"/> 
        </Grid>
        
        <!-- Main Layout: Sidebar + Content Carousel -->
        <!-- Only visible when not obscured by global overlay -->
        <Grid Tag="{Binding IsOverlayOpen}">
            <Grid.Styles>
                <Style Selector="Grid[Tag=True]">
                    <Setter Property="Effect" Value="blur(16)"/>
                </Style>
            </Grid.Styles>
            <Grid.Transitions>
                <Transitions>
                    <DoubleTransition Property="Opacity" Duration="0:0:0.8" Easing="CubicEaseInOut"/>
                </Transitions>
            </Grid.Transitions>
            
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="80"/>
                <ColumnDefinition Width="*"/>
            </Grid.ColumnDefinitions>

            <!-- SIDEBAR NAVIGATION -->
            <Border Grid.Column="0" Background="#99000000" BorderBrush="#33FFFFFF" BorderThickness="0,0,1,0">
                <StackPanel VerticalAlignment="Center" Spacing="24" HorizontalAlignment="Center">
                    
                    <!-- HOME -->
                    <btn:IconButton Command="{Binding NavigateCommand}"
                                    CommandParameter="{x:Static vm:NavigationPage.Home}"
                                    ButtonBackground="Transparent"
                                    Width="50" Height="50"
                                    IconPath="/Assets/Icons/home.svg"
                                    IconSize="28"
                                    ToolTip.Tip="Home"/>
                    
                    <!-- NEWS -->
                    <btn:IconButton Command="{Binding NavigateCommand}"
                                    CommandParameter="{x:Static vm:NavigationPage.News}"
                                    ButtonBackground="Transparent"
                                    Width="50" Height="50"
                                    IconPath="/Assets/Icons/globe.svg"
                                    IconSize="28"
                                    ToolTip.Tip="News"/>

                    <!-- SETTINGS -->
                    <btn:IconButton Command="{Binding NavigateCommand}"
                                    CommandParameter="{x:Static vm:NavigationPage.Settings}"
                                    ButtonBackground="Transparent"
                                    Width="50" Height="50"
                                    IconPath="/Assets/Icons/settings.svg"
                                    IconSize="28"
                                    ToolTip.Tip="Settings"/>
                                    
                    <!-- MODS (Disabled/Future) -->
                    <btn:IconButton Command="{Binding NavigateCommand}"
                                    CommandParameter="{x:Static vm:NavigationPage.Mods}"
                                    ButtonBackground="Transparent"
                                    Width="50" Height="50"
                                    IconPath="/Assets/Icons/package.svg"
                                    IconSize="28"
                                    ToolTip.Tip="Mod Manager"/>
                </StackPanel>
            </Border>

            <!-- PAGE CONTENT CAROUSEL -->
            <Carousel Grid.Column="1" SelectedIndex="{Binding CurrentPage}">
                <Carousel.PageTransition>
                    <trans:SlideFadeOutTransition Duration="0:0:0.55" Offset="40" IsVertical="True"/>
                </Carousel.PageTransition>
                
                <!-- 0: HOME SCREEN -->
                <Grid Margin="30">
                     <!-- Header Component -->
                    <dashboard:Header DataContext="{Binding HeaderViewModel}" VerticalAlignment="Top" />
                    
                    <!-- Center Content (Placeholder for Hero/Welcome) -->
                    <StackPanel VerticalAlignment="Center" HorizontalAlignment="Left" Margin="0,0,0,100" Spacing="10">
                        <TextBlock Text="WELCOME TO HYPRISM" FontSize="48" FontWeight="Bold" Foreground="White" Opacity="0.9"/>
                        <TextBlock Text="YOUR GATEWAY TO ADVENTURE" FontSize="20" FontWeight="Light" Foreground="#CCC" Opacity="0.8"/>
                    </StackPanel>

                    <!-- Game Control Bar (Bottom Actions + Play) -->
                    <!-- We use the existing component but might need to adjust it to not show redundant buttons -->
                    <dashboard:GameControlBar DataContext="{Binding GameControlViewModel}" VerticalAlignment="Bottom" />
                </Grid>

                <!-- 1: NEWS SCREEN -->
                <!-- Solid background to prevent overlap transparency artifacts -->
                <Border Background="#000000">
                    <Grid Margin="40">
                        <TextBlock Text="LATEST NEWS" FontSize="32" FontWeight="Bold" Foreground="White" Margin="0,0,0,20"/>
                        <views:NewsView DataContext="{Binding NewsViewModel}" Margin="0,60,0,0"/>
                    </Grid>
                </Border>

                <!-- 2: SETTINGS SCREEN -->
                <Border Background="#000000">
                    <Grid Margin="40">
                        <TextBlock Text="SETTINGS" FontSize="32" FontWeight="Bold" Foreground="White" Margin="0,0,0,20"/>
                        <views:SettingsView DataContext="{Binding SettingsViewModel}" Margin="0,60,0,0"/>
                    </Grid>
                </Border>
                
                <!-- 3: MOD MANAGER SCREEN -->
                <Border Background="#000000">
                    <Grid Margin="40">
                        <TextBlock Text="MOD MANAGER" FontSize="32" FontWeight="Bold" Foreground="White" Margin="0,0,0,20"/>
                        <views:ModManagerView DataContext="{Binding ModManagerViewModel}" Margin="0,60,0,0"/>
                    </Grid>
                </Border>

            </Carousel>
        </Grid>
        
        <!-- Global Modals (Profile, Error, Launch) -->
        
        <!-- Profile Editor Overlay -->
        <Grid Classes="overlay-layer" Tag="{Binding IsProfileEditorOpen}" ZIndex="100">
            <Border Background="#B3000000"/>
            <layouts:ModalWrapper IsOpen="{Binding IsProfileEditorOpen}">
                <views:ProfileEditorView DataContext="{Binding ProfileEditorViewModel}" Width="700" Height="600" VerticalAlignment="Center" HorizontalAlignment="Center"/>
            </layouts:ModalWrapper>
        </Grid>
        
        <!-- Update/Download Progress Overlay -->
        <views:LaunchOverlayView DataContext="{Binding}"/>

        <!-- Error Modal -->
        <views:ErrorModalView DataContext="{Binding}"/>
        
    </Grid>
</UserControl>
