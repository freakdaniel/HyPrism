<UserControl xmlns="https://github.com/avaloniaui"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
             xmlns:vm="using:HyPrism.UI.ViewModels"
             xmlns:svg="clr-namespace:Avalonia.Svg.Skia;assembly=Avalonia.Svg.Skia"
             mc:Ignorable="d" d:DesignWidth="1280" d:DesignHeight="800"
             x:Class="HyPrism.UI.Views.UpdateOverlayView"
             x:DataType="vm:MainViewModel">
    
    <Grid IsVisible="{Binding IsDownloading}" 
          Opacity="{Binding OverlayOpacity}"
          Background="#F2090909">
        <Grid.Transitions>
            <Transitions>
                <DoubleTransition Property="Opacity" Duration="0:0:0.5" Easing="CubicEaseInOut"/>
            </Transitions>
        </Grid.Transitions>
        
        <!-- Content -->
        <StackPanel VerticalAlignment="Center" HorizontalAlignment="Center" Spacing="30" MaxWidth="500">
            <!-- Animated Icon (changes based on state) -->
            <Viewbox Width="80" Height="80" HorizontalAlignment="Center">
                <svg:Svg Path="{Binding ProgressIconPath}" Width="80" Height="80">
                    <svg:Svg.Transitions>
                        <Transitions>
                            <DoubleTransition Property="Opacity" Duration="0:0:0.4" Easing="CubicEaseInOut"/>
                        </Transitions>
                    </svg:Svg.Transitions>
                    <svg:Svg.Styles>
                        <Style Selector="svg|Svg">
                            <Style.Animations>
                                <Animation Duration="0:0:2" IterationCount="Infinite" Easing="SineEaseInOut">
                                    <KeyFrame Cue="0%">
                                        <Setter Property="TranslateTransform.Y" Value="0"/>
                                        <Setter Property="Opacity" Value="1"/>
                                    </KeyFrame>
                                    <KeyFrame Cue="50%">
                                        <Setter Property="TranslateTransform.Y" Value="-5"/>
                                        <Setter Property="Opacity" Value="0.8"/>
                                    </KeyFrame>
                                    <KeyFrame Cue="100%">
                                        <Setter Property="TranslateTransform.Y" Value="0"/>
                                        <Setter Property="Opacity" Value="1"/>
                                    </KeyFrame>
                                </Animation>
                            </Style.Animations>
                        </Style>
                    </svg:Svg.Styles>
                </svg:Svg>
            </Viewbox>
            
            <!-- Title -->
            <TextBlock Text="{Binding ProgressText}" 
                       FontSize="48" 
                       FontWeight="Black" 
                       HorizontalAlignment="Center"
                       Foreground="White"
                       TextAlignment="Center"
                       TextWrapping="Wrap"/>
            
            <!-- Subtitle -->
            <TextBlock Text="Please wait while we download and install the game files." 
                       FontSize="16" 
                       Foreground="#999"
                       HorizontalAlignment="Center"
                       TextAlignment="Center"
                       MaxWidth="400"
                       TextWrapping="Wrap"/>
            
            <!-- Progress Bar -->
            <StackPanel Spacing="12" Width="500">
                <!-- Bar Container -->
                <Border Height="12" 
                        Background="#1A1A1A" 
                        CornerRadius="6" 
                        ClipToBounds="True">
                    <!-- Progress Fill -->
                    <Border Background="{DynamicResource HytaleOrangeBrush}"
                            HorizontalAlignment="Left"
                            Width="{Binding ProgressValue, Converter={StaticResource ProgressToWidthConverter}}"
                            CornerRadius="6">
                        <Border.Transitions>
                            <Transitions>
                                <DoubleTransition Property="Width" Duration="0:0:0.3" Easing="CubicEaseOut"/>
                            </Transitions>
                        </Border.Transitions>
                    </Border>
                </Border>
                
                <!-- Stats Row -->
                <Grid ColumnDefinitions="*, Auto">
                    <TextBlock Grid.Column="0" 
                               Text="{Binding DownloadSpeedText}" 
                               FontSize="13" 
                               Foreground="#999"/>
                    <TextBlock Grid.Column="1" 
                               FontSize="13" 
                               FontWeight="Bold"
                               Foreground="{DynamicResource HytaleOrangeBrush}">
                        <Run Text="{Binding ProgressValue, StringFormat='{}{0:F0}'}"/>
                        <Run Text="%"/>
                    </TextBlock>
                </Grid>
            </StackPanel>
            
            <!-- Footer Note -->
            <TextBlock Text="The game will launch automatically when ready." 
                       FontSize="11" 
                       Foreground="#555"
                       HorizontalAlignment="Center"/>
        </StackPanel>
    </Grid>
    
</UserControl>
